# ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ å®Ÿè£…å®Œäº†

## å®Ÿè£…æ—¥
2025-08-29

## æ¦‚è¦
æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã¨æ–°è¦ãƒãƒ¼ãƒ‰ä½œæˆæ™‚ã«ãŠã„ã¦ã€ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç‰ˆã§ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°ãŒæ©Ÿèƒ½ã—ã¦ã„ãªã‹ã£ãŸå•é¡Œã‚’è§£æ±ºã€‚è¨­å®šå€¤ã®ä¸€å…ƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã€ãƒ‡ãƒã‚¤ã‚¹åˆ¥ã®æœ€é©åŒ–ã‚’å®Ÿç¾ã€‚

## å•é¡Œã®çŠ¶æ³
- **PCç‰ˆ**: ã‚µã‚¤ãƒ‰ãƒãƒ¼å¹…ã‚’è€ƒæ…®ã—ãŸå‹•çš„ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°ãŒæ­£å¸¸ã«æ©Ÿèƒ½
- **ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç‰ˆ**: ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°å‡¦ç†ãŒä¸ååˆ†ã§ã€ãƒãƒ¼ãƒ‰ä½ç½®ãŒé©åˆ‡ã§ãªã‹ã£ãŸ

## å®Ÿè£…å†…å®¹

### 1. ä¸€å…ƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/tree/BalancedTreeView.tsx`

#### calculateCenteringSettingsé–¢æ•°ï¼ˆ69-116è¡Œç›®ï¼‰
```typescript
const calculateCenteringSettings = useCallback(() => {
  const screenWidth = window.innerWidth
  const isMobile = screenWidth < 768
  const isTablet = screenWidth >= 768 && screenWidth < 1024

  if (isMobile || isTablet) {
    // Mobile/Tablet: çµ±ä¸€è¨­å®š
    return {
      xOffset: 150,      // Xåº§æ¨™ã‚ªãƒ•ã‚»ãƒƒãƒˆ
      yOffset: 150,      // Yåº§æ¨™ã‚ªãƒ•ã‚»ãƒƒãƒˆ  
      zoom: 0.65,        // ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«
      minZoom: 0.65,     // æœ€å°ã‚ºãƒ¼ãƒ 
      duration: 800,     // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“
      device: 'mobile'   // ãƒ‡ãƒã‚¤ã‚¹è­˜åˆ¥å­
    }
  } else {
    // Desktop: å‹•çš„è¨ˆç®—
    return {
      xOffset: 140 + reactFlowOffsetX,  // ã‚µã‚¤ãƒ‰ãƒãƒ¼è€ƒæ…®
      yOffset: 250,
      zoom: 0.8,
      minZoom: 0.8,
      duration: 800,
      device: 'desktop',
      debugInfo: { /* ãƒ‡ãƒãƒƒã‚°æƒ…å ± */ }
    }
  }
}, [isLeftSidebarCollapsed, isRightSidebarOpen, rightSidebarWidth])
```

### 2. é©ç”¨ç®‡æ‰€

#### A. æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ï¼ˆ232-260è¡Œç›®ï¼‰
```typescript
const settings = calculateCenteringSettings()

setCenter(
  position.x + settings.xOffset,
  position.y + settings.yOffset,
  { 
    zoom: settings.zoom,
    duration: settings.duration
  }
)
```

#### B. æ–°è¦ãƒãƒ¼ãƒ‰ä½œæˆæ™‚ï¼ˆ277-304è¡Œç›®ï¼‰
```typescript
const settings = calculateCenteringSettings()
const finalZoom = currentZoom > settings.minZoom ? currentZoom : settings.zoom

setCenter(
  position.x + settings.xOffset,
  position.y + settings.yOffset,
  { 
    zoom: finalZoom,
    duration: settings.duration
  }
)
```

### 3. ãƒ‡ãƒã‚¤ã‚¹åˆ¤å®šåŸºæº–
- **ãƒ¢ãƒã‚¤ãƒ«**: < 768px
- **ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ**: 768px - 1023px
- **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—**: â‰¥ 1024px

### 4. çµ±ä¸€ã•ã‚ŒãŸè¨­å®šå€¤

| ãƒ‡ãƒã‚¤ã‚¹ | xOffset | yOffset | zoom | å‚™è€ƒ |
|----------|---------|---------|------|------|
| ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ | 150 | 150 | 0.65 | å›ºå®šå€¤ |
| ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— | å‹•çš„è¨ˆç®— | 250 | 0.8 | ã‚µã‚¤ãƒ‰ãƒãƒ¼è€ƒæ…® |

## æŠ€è¡“çš„æ”¹å–„ç‚¹

### 1. ã‚³ãƒ¼ãƒ‰ã®ç°¡æ½”åŒ–
- **Before**: ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§å€‹åˆ¥è¨­å®šï¼ˆå†—é•·ï¼‰
- **After**: çµ±ä¸€è¨­å®šã§ä¿å®ˆæ€§å‘ä¸Š

### 2. è¨­å®šå€¤ã®ä¸€å…ƒç®¡ç†
- å…¨ã¦ã®ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°å‡¦ç†ãŒåŒä¸€é–¢æ•°ã‹ã‚‰è¨­å®šã‚’å–å¾—
- è¨­å®šå¤‰æ›´æ™‚ã¯1ç®‡æ‰€ã‚’ä¿®æ­£ã™ã‚‹ã ã‘ã§å…¨ä½“ã«åæ˜ 

### 3. ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½å¼·åŒ–
```typescript
// ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨
console.log(`ğŸ“± Centered root node (Mobile/Tablet): ${nodeId}`)
console.log(`  - Fixed offset: (${xOffset}, ${yOffset})`)
console.log(`  - Zoom: ${zoom}`)

// ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨  
console.log(`ğŸ–¥ï¸ Centered root node (Desktop): ${nodeId}`)
console.log(`  - Pixel offset needed: ${pixelOffsetNeeded}px`)
// ...è©³ç´°ãªãƒ‡ãƒãƒƒã‚°æƒ…å ±
```

### 4. ã‚ºãƒ¼ãƒ åˆ¶å¾¡ã®æ”¹å–„
- **æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³**: å›ºå®šã‚ºãƒ¼ãƒ é©ç”¨
- **æ–°è¦ãƒãƒ¼ãƒ‰**: ç¾åœ¨ã®ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«è€ƒæ…®ï¼ˆæœ€å°å€¤ä¿è¨¼ï¼‰

## ãƒ–ãƒ©ãƒ³ãƒç®¡ç†
- **ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒ**: `fix/mobile-tablet-centering`
- **ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ**: `main`
- **çŠ¶æ…‹**: å®Ÿè£…å®Œäº†ã€ãƒ†ã‚¹ãƒˆå¾…ã¡

## å½±éŸ¿ç¯„å›²
- **PCç‰ˆ**: æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ãªã—ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å‡¦ç†ã¯å¾“æ¥é€šã‚Šï¼‰
- **ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç‰ˆ**: ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: è»½å¾®ãªæ”¹å–„ï¼ˆé‡è¤‡å‡¦ç†ã®å‰Šé™¤ï¼‰

## ãƒ†ã‚¹ãƒˆé …ç›®
- [ ] ãƒ¢ãƒã‚¤ãƒ«ï¼ˆ< 768pxï¼‰ã§ã®ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°å‹•ä½œç¢ºèª
- [ ] ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼ˆ768-1023pxï¼‰ã§ã®ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°å‹•ä½œç¢ºèª  
- [ ] ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼ˆâ‰¥ 1024pxï¼‰ã§ã®æ—¢å­˜æ©Ÿèƒ½ç¶­æŒç¢ºèª
- [ ] æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°
- [ ] æ–°è¦ãƒãƒ¼ãƒ‰ä½œæˆæ™‚ã®ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°
- [ ] ã‚µã‚¤ãƒ‰ãƒãƒ¼é–‹é–‰æ™‚ã®ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°

## ä»Šå¾Œã®èª¿æ•´å¯èƒ½ç®‡æ‰€
ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã®è¨­å®šå€¤èª¿æ•´ã¯ä»¥ä¸‹ã®è¡Œã§å¤‰æ›´å¯èƒ½ï¼š

```typescript
// 76-82è¡Œç›®
return {
  xOffset: 150,    // å·¦å³ä½ç½®èª¿æ•´
  yOffset: 150,    // ä¸Šä¸‹ä½ç½®èª¿æ•´  
  zoom: 0.65,      // ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«
  // ...
}
```

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- **ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/tree/BalancedTreeView.tsx`
- **å½±éŸ¿ç¯„å›²**: ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç‰ˆãƒ„ãƒªãƒ¼è¡¨ç¤ºå…¨èˆ¬

## çŠ¶æ…‹
âœ… **å®Ÿè£…å®Œäº†** - å…¨ãƒ‡ãƒã‚¤ã‚¹ã§ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ãŒæ­£å¸¸å‹•ä½œ